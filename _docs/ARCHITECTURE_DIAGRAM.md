# Architecture Diagram - Portfolio Analysis

## ğŸ“ Architecture Avant/AprÃ¨s

### âŒ AVANT : Architecture Monolithique

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                               â”‚
â”‚                    menu_principal.py                          â”‚
â”‚                        (822 lignes)                           â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Setup UI                                            â”‚   â”‚
â”‚  â”‚  - Create panels                                     â”‚   â”‚
â”‚  â”‚  - Create widgets                                    â”‚   â”‚
â”‚  â”‚  - Bind events                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Currency Management                                 â”‚   â”‚
â”‚  â”‚  - Get currency symbol                               â”‚   â”‚
â”‚  â”‚  - Update currency labels                            â”‚   â”‚
â”‚  â”‚  - Handle currency changes                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Portfolio Management                                â”‚   â”‚
â”‚  â”‚  - Calculate weight total                            â”‚   â”‚
â”‚  â”‚  - Update weights/amounts                            â”‚   â”‚
â”‚  â”‚  - Normalize weights                                 â”‚   â”‚
â”‚  â”‚  - Equal weights                                     â”‚   â”‚
â”‚  â”‚  - Clear weights/portfolio                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Market Data Management                              â”‚   â”‚
â”‚  â”‚  - Load forex rates                                  â”‚   â”‚
â”‚  â”‚  - Load major indexes                                â”‚   â”‚
â”‚  â”‚  - Refresh forex                                     â”‚   â”‚
â”‚  â”‚  - Refresh indexes                                   â”‚   â”‚
â”‚  â”‚  - Auto-refresh timer                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Summary Updates                                     â”‚   â”‚
â”‚  â”‚  - Update portfolio summary                          â”‚   â”‚
â”‚  â”‚  - Update benchmark summary                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Chart Selection & Analysis                          â”‚   â”‚
â”‚  â”‚  - Select/deselect charts                            â”‚   â”‚
â”‚  â”‚  - Run analysis                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ProblÃ¨mes :**
- âŒ Trop de responsabilitÃ©s (6)
- âŒ Difficile Ã  maintenir
- âŒ Difficile Ã  tester
- âŒ Code mÃ©langÃ© (UI + logique)

---

### âœ… APRÃˆS : Architecture Modulaire

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         menu_principal.py                              â”‚
â”‚                       (434 lignes - Orchestrateur)                     â”‚
â”‚                                                                        â”‚
â”‚  ResponsabilitÃ©s :                                                     â”‚
â”‚  - Coordination gÃ©nÃ©rale                                               â”‚
â”‚  - Gestion de l'interface utilisateur                                 â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                â”‚                â”‚             â”‚
             â”‚                â”‚                â”‚             â”‚
             â–¼                â–¼                â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CurrencyManagerâ”‚ â”‚PortfolioManagerâ”‚ â”‚MarketData   â”‚ â”‚ Other Modulesâ”‚
    â”‚   (134 lignes) â”‚ â”‚   (262 lignes) â”‚ â”‚Manager      â”‚ â”‚              â”‚
    â”‚                â”‚ â”‚                â”‚ â”‚ (125 lignes)â”‚ â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Architecture DÃ©taillÃ©e (AprÃ¨s)

### Vue d'Ensemble des Modules

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       APPLICATION LAYER                             â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              menu_principal.py (Orchestrator)                â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  - Initialize all modules                                    â”‚ â”‚
â”‚  â”‚  - Coordinate user interactions                              â”‚ â”‚
â”‚  â”‚  - Delegate to specialized modules                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚                           â”‚
        â–¼                          â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI LAYER      â”‚        â”‚  BUSINESS LOGIC  â”‚       â”‚  DATA LAYER     â”‚
â”‚               â”‚        â”‚                  â”‚       â”‚                 â”‚
â”‚ ui_builder.py â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¤ CurrencyManager  â”‚â—„â”€â”€â”€â”€â”€â”€â”¤ utils_data.py   â”‚
â”‚               â”‚        â”‚ PortfolioManager â”‚       â”‚                 â”‚
â”‚               â”‚        â”‚ MarketDataMgr    â”‚       â”‚ config.py       â”‚
â”‚ theme_colors  â”‚        â”‚                  â”‚       â”‚                 â”‚
â”‚               â”‚        â”‚ symbol_handler   â”‚       â”‚ (caches)        â”‚
â”‚               â”‚        â”‚                  â”‚       â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  ANALYSIS LAYER  â”‚
                         â”‚                  â”‚
                         â”‚ analysis_runner  â”‚
                         â”‚                  â”‚
                         â”‚ chart_*.py       â”‚
                         â”‚                  â”‚
                         â”‚ utils_math.py    â”‚
                         â”‚ utils_plot.py    â”‚
                         â”‚                  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ DÃ©tail des Modules

### 1. CurrencyManager

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       CurrencyManager               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Methods:                           â”‚
â”‚  â”œâ”€ get_symbol(code)               â”‚
â”‚  â”œâ”€ get_name(code)                 â”‚
â”‚  â”œâ”€ get_display_text(code)         â”‚
â”‚  â”œâ”€ is_valid_currency(code)        â”‚
â”‚  â”œâ”€ format_amount(amt, code)       â”‚
â”‚  â””â”€ get_all_currencies()           â”‚
â”‚                                     â”‚
â”‚  Data:                              â”‚
â”‚  â”œâ”€ CURRENCY_SYMBOLS {dict}        â”‚
â”‚  â””â”€ CURRENCY_NAMES {dict}          â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. PortfolioManager

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PortfolioManager              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Methods:                           â”‚
â”‚  â”œâ”€ calculate_weight_total()       â”‚
â”‚  â”œâ”€ update_amount_from_weight(i)   â”‚
â”‚  â”œâ”€ update_weight_from_amount(i)   â”‚
â”‚  â”œâ”€ normalize_weights()            â”‚
â”‚  â”œâ”€ set_equal_weights()            â”‚
â”‚  â”œâ”€ clear_all_weights()            â”‚
â”‚  â”œâ”€ update_all_amounts()           â”‚
â”‚  â”œâ”€ update_currency_labels(sym)    â”‚
â”‚  â””â”€ get_validated_tickers_count()  â”‚
â”‚                                     â”‚
â”‚  Data:                              â”‚
â”‚  â”œâ”€ ticker_rows                    â”‚
â”‚  â”œâ”€ get_capital (callback)         â”‚
â”‚  â””â”€ get_currency_symbol (callback) â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. MarketDataManager

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MarketDataManager              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Methods:                           â”‚
â”‚  â”œâ”€ load_all_market_data()         â”‚
â”‚  â”œâ”€ refresh_forex()                â”‚
â”‚  â”œâ”€ refresh_indexes()              â”‚
â”‚  â”œâ”€ start_auto_refresh()           â”‚
â”‚  â”œâ”€ stop_auto_refresh()            â”‚
â”‚  â””â”€ cleanup()                      â”‚
â”‚                                     â”‚
â”‚  Data:                              â”‚
â”‚  â”œâ”€ forex_update_callback          â”‚
â”‚  â”œâ”€ indexes_update_callback        â”‚
â”‚  â”œâ”€ forex_refresh_btn              â”‚
â”‚  â”œâ”€ indexes_refresh_btn            â”‚
â”‚  â””â”€ auto_refresh_timer             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flux de DonnÃ©es

### Exemple 1 : Changement de Devise

```
User clicks currency
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  menu_principal  â”‚ _on_currency_change()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                          â”‚
         â–¼                          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Currency   â”‚          â”‚   Portfolio     â”‚
  â”‚  Manager    â”‚          â”‚   Manager       â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                          â”‚
         â”‚ get_symbol("EUR")        â”‚ update_currency_labels("â‚¬")
         â”‚                          â”‚ update_all_amounts()
         â–¼                          â–¼
      return "â‚¬"            Update all UI widgets
```

### Exemple 2 : RafraÃ®chissement Market Data

```
User clicks "Refresh"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  menu_principal  â”‚ (binds button to manager)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  MarketData     â”‚ refresh_forex()
  â”‚  Manager        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ Show "Loading..."
           â”‚
           â”œâ”€ Start background thread
           â”‚      â”‚
           â”‚      â–¼
           â”‚   Fetch data (utils_data.py)
           â”‚      â”‚
           â”‚      â–¼
           â”‚   Update UI callback
           â”‚
           â””â”€ Restore button state
```

### Exemple 3 : Calcul des Poids

```
User changes weight
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  menu_principal  â”‚ _on_weight_change(idx)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Portfolio     â”‚ update_amount_from_weight(idx)
  â”‚   Manager       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ Get weight from entry
           â”‚
           â”œâ”€ Get capital (callback)
           â”‚
           â”œâ”€ Calculate amount = weight * capital / 100
           â”‚
           â”œâ”€ Format amount (1,234)
           â”‚
           â””â”€ Update amount entry widget
```

---

## ğŸ¯ SÃ©paration des ResponsabilitÃ©s

### Avant (Monolithique)

```
menu_principal.py
â”œâ”€ UI Setup             â”€â”
â”œâ”€ Currency Management   â”œâ”€ Tout dans un seul fichier
â”œâ”€ Portfolio Management  â”œâ”€ 822 lignes
â”œâ”€ Market Data          â”œâ”€ Difficile Ã  maintenir
â”œâ”€ Summary Updates      â”œâ”€ Difficile Ã  tester
â””â”€ Analysis Execution   â”€â”˜
```

### AprÃ¨s (Modulaire)

```
menu_principal.py (434 lignes)
â”œâ”€ UI Setup
â”œâ”€ Coordination
â””â”€ Delegation
    â”‚
    â”œâ”€ currency_manager.py (134 lignes)
    â”‚  â””â”€ Currency logic
    â”‚
    â”œâ”€ portfolio_manager.py (262 lignes)
    â”‚  â””â”€ Portfolio logic
    â”‚
    â””â”€ market_data_manager.py (125 lignes)
       â””â”€ Market data logic
```

---

## ğŸ“Š Comparaison Visuelle

```
AVANT                           APRÃˆS

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚            â”‚               â”‚
â”‚                 â”‚            â”‚  menu_        â”‚
â”‚  menu_          â”‚            â”‚  principal    â”‚
â”‚  principal      â”‚            â”‚               â”‚
â”‚                 â”‚            â”‚  (434 lines)  â”‚
â”‚  (822 lines)    â”‚            â”‚               â”‚
â”‚                 â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                 â”‚                    â”‚
â”‚  [Everything]   â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚        â”‚           â”‚           â”‚
â”‚                 â”‚        â–¼           â–¼           â–¼
â”‚                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚    â”‚Cur    â”‚  â”‚Port   â”‚  â”‚Market â”‚
â”‚                 â”‚    â”‚Mgr    â”‚  â”‚Mgr    â”‚  â”‚Data   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜

  Monolithique              Modulaire
  822 lignes               434 + 3 modules
  6 responsabilitÃ©s        2 + 3 modules
  Difficile Ã  tester       Facile Ã  tester
```

---

## ğŸ—ï¸ Architecture en Couches

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PRESENTATION LAYER                     â”‚
â”‚  (menu_principal.py + ui_builder.py)            â”‚
â”‚  - User interface                                â”‚
â”‚  - Event handling                                â”‚
â”‚  - Display updates                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           BUSINESS LOGIC LAYER                   â”‚
â”‚  (currency_mgr, portfolio_mgr, market_data_mgr) â”‚
â”‚  - Currency operations                           â”‚
â”‚  - Portfolio calculations                        â”‚
â”‚  - Market data fetching                          â”‚
â”‚  - Symbol validation                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DATA LAYER                             â”‚
â”‚  (config.py, utils_data.py, caches)             â”‚
â”‚  - Configuration                                 â”‚
â”‚  - Data fetching                                 â”‚
â”‚  - Caching                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ANALYSIS LAYER                         â”‚
â”‚  (analysis_runner, chart_*, utils_math)         â”‚
â”‚  - Portfolio analysis                            â”‚
â”‚  - Chart generation                              â”‚
â”‚  - Mathematical calculations                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ¨ BÃ©nÃ©fices de la Nouvelle Architecture

### MaintenabilitÃ© â­â­â­â­â­
- Code organisÃ© en modules logiques
- Modifications localisÃ©es
- Facile Ã  comprendre

### TestabilitÃ© â­â­â­â­â­
- Modules testables indÃ©pendamment
- Mock/stub faciles
- Tests automatisÃ©s possibles

### RÃ©utilisabilitÃ© â­â­â­â­â­
- Modules rÃ©utilisables
- API claire
- Pas de dÃ©pendances circulaires

### Ã‰volutivitÃ© â­â­â­â­â­
- Ajout de fonctionnalitÃ©s facilitÃ©
- Extension des modules simple
- Architecture prÃªte pour le futur

---

**Date :** Octobre 2024  
**Version :** 2.0 (Architecture Modulaire)  
**Status :** âœ… Production


